document.addEventListener('DOMContentLoaded',()=>{let{indexName,appID,apiKey,hits}=CONFIG.algolia,client=window['algoliasearch/lite'].liteClient(appID,apiKey),input=document.querySelector('.search-input'),container=document.querySelector('.search-result-container'),formatHits=data=>{var{title,excerpt,excerptStrip,contentStripTruncate}=data._highlightResult;let result=`<li><a href="${data.permalink}" class="search-result-title">${title.value}</a>`;title=excerpt?.value||excerptStrip?.value||contentStripTruncate?.value;return title&&((excerpt=document.createElement('div')).innerHTML=title,result+=`<a href="${data.permalink}"><p class="search-result">${excerpt.textContent.substring(0,100)}...</p></a></li>`),result},isSearching=!1,pendingQuery=null,searchAlgolia=async(searchText,page=0)=>{if(isSearching)pendingQuery={searchText:searchText,page:page};else{isSearching=!0;var startTime=Date.now(),data=(await client.search({requests:[{indexName:indexName,page:page,query:searchText,hitsPerPage:hits.per_page||10,attributesToRetrieve:['permalink'],attributesToHighlight:['title','excerpt','excerptStrip','contentStripTruncate'],highlightPreTag:'<mark class="search-keyword">',highlightPostTag:'</mark>'}]})).results[0];if(0===data.nbHits)container.innerHTML='<div class="search-result-icon"><i class="far fa-frown fa-5x"></i></div>';else{startTime=CONFIG.i18n.hits_time.replace('${hits}',data.nbHits).replace('${time}',Date.now()-startTime);let pagination='';if(1<data.nbPages){pagination+='<nav class="pagination algolia-pagination">';for(let i=0;i<data.nbPages;i++)i===page?pagination+=`<span class="page-number current">${i+1}</span>`:pagination+=`<a class="page-number" href="#" data-index=${i}>${i+1}</a>`;pagination+='</nav>'}container.innerHTML=`<div class="search-stats">
          <span>${startTime}</span>
          <img src="${CONFIG.images}/logo-algolia-nebula-blue-full.svg" alt="Algolia">
        </div>
        <hr>
        <ul class="search-result-list">${data.hits.map(formatHits).join('')}</ul>
        `+pagination,'object'==typeof pjax&&pjax.refresh(container),container.querySelectorAll('.page-number').forEach(element=>{element.addEventListener('click',async event=>{event.preventDefault(),await searchAlgolia(searchText,Number(element.dataset.index))})})}if(isSearching=!1,null!==pendingQuery&&(pendingQuery.searchText!==searchText||pendingQuery.page!==page)){let{searchText,page}=pendingQuery;pendingQuery=null,searchAlgolia(searchText,page)}}};var debouncedSearch=NexT.utils.debounce(async()=>{var searchText=input.value.trim();''===searchText?container.innerHTML='<div class="search-result-icon"><i class="fab fa-algolia fa-5x"></i></div>':await searchAlgolia(searchText,0)},500);input.addEventListener('input',debouncedSearch),document.querySelectorAll('.popup-trigger').forEach(element=>{element.addEventListener('click',()=>{NexT.utils.setGutter(),document.body.classList.add('search-active'),setTimeout(()=>input.focus(),500)})});let onPopupClose=()=>{NexT.utils.setGutter('0'),document.body.classList.remove('search-active')};document.querySelector('.search-pop-overlay').addEventListener('click',event=>{event.target===document.querySelector('.search-pop-overlay')&&onPopupClose()}),document.querySelector('.popup-btn-close').addEventListener('click',onPopupClose),document.addEventListener('pjax:success',onPopupClose),window.addEventListener('keydown',event=>{(event.ctrlKey||event.metaKey)&&'k'===event.key&&(event.preventDefault(),NexT.utils.setGutter(),document.body.classList.add('search-active'),setTimeout(()=>input.focus(),500))}),window.addEventListener('keyup',event=>{'Escape'===event.key&&onPopupClose()})});