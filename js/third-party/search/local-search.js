document.addEventListener('DOMContentLoaded',()=>{if(CONFIG.path){let localSearch=new LocalSearch({path:CONFIG.path,top_n_per_article:CONFIG.localsearch.top_n_per_article,unescape:CONFIG.localsearch.unescape}),input=document.querySelector('.search-input'),container=document.querySelector('.search-result-container');var inputEventFunction=()=>{if(localSearch.isfetched){var searchText=input.value.trim().toLowerCase(),keywords=searchText.split(/[-\s]+/);let resultItems=[];0<searchText.length&&(resultItems=localSearch.getResultItems(keywords)),1===keywords.length&&''===keywords[0]?container.innerHTML='<div class="search-result-icon"><i class="fa fa-search fa-5x"></i></div>':0===resultItems.length?container.innerHTML='<div class="search-result-icon"><i class="far fa-frown fa-5x"></i></div>':(resultItems.sort((left,right)=>left.includedCount!==right.includedCount?right.includedCount-left.includedCount:left.hitCount!==right.hitCount?right.hitCount-left.hitCount:right.id-left.id),searchText=CONFIG.i18n.hits.replace('${hits}',resultItems.length),container.innerHTML=`<div class="search-stats">${searchText}</div>
        <hr>
        <ul class="search-result-list">${resultItems.map(result=>result.item).join('')}</ul>`,'object'==typeof pjax&&pjax.refresh(container))}};localSearch.highlightSearchWords(document.querySelector('.post-body')),CONFIG.localsearch.preload&&localSearch.fetchData(),input.addEventListener('input',inputEventFunction),window.addEventListener('search:loaded',inputEventFunction),document.querySelectorAll('.popup-trigger').forEach(element=>{element.addEventListener('click',()=>{NexT.utils.setGutter(),document.body.classList.add('search-active'),setTimeout(()=>input.focus(),500),localSearch.isfetched||localSearch.fetchData()})});let onPopupClose=()=>{NexT.utils.setGutter('0'),document.body.classList.remove('search-active')};document.querySelector('.search-pop-overlay').addEventListener('click',event=>{event.target===document.querySelector('.search-pop-overlay')&&onPopupClose()}),document.querySelector('.popup-btn-close').addEventListener('click',onPopupClose),document.addEventListener('pjax:success',()=>{localSearch.highlightSearchWords(document.querySelector('.post-body')),onPopupClose()}),window.addEventListener('keydown',event=>{(event.ctrlKey||event.metaKey)&&'k'===event.key&&(event.preventDefault(),NexT.utils.setGutter(),document.body.classList.add('search-active'),setTimeout(()=>input.focus(),500),localSearch.isfetched||localSearch.fetchData())}),window.addEventListener('keyup',event=>{'Escape'===event.key&&onPopupClose()})}else console.warn('`hexo-generator-searchdb` plugin is not installed!')});