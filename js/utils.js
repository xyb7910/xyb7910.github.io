HTMLElement.prototype.wrap=function(wrapper){this.parentNode.insertBefore(wrapper,this),this.parentNode.removeChild(this),wrapper.appendChild(this)},(()=>{var onPageLoaded=()=>document.dispatchEvent(new Event('page:loaded',{bubbles:!0}));document.addEventListener('DOMContentLoaded',onPageLoaded),document.addEventListener('pjax:success',onPageLoaded)})(),NexT.utils={registerExtURL(){document.querySelectorAll('span.exturl').forEach(element=>{var link=document.createElement('a');link.href=decodeURIComponent(atob(element.dataset.url).split('').map(c=>'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2)).join('')),link.rel='noopener external nofollow noreferrer',link.target='_blank',link.className=element.className,link.title=element.title,link.innerHTML=element.innerHTML,element.parentNode.replaceChild(link,element)})},registerCopyButton(target,element,code=''){target.insertAdjacentHTML('beforeend','<div class="copy-btn"><i class="fa fa-copy fa-fw"></i></div>');let button=target.querySelector('.copy-btn');button.addEventListener('click',async()=>{var lines;if(code||(lines=element.querySelector('.code')||element.querySelector('code'),code=lines.innerText),navigator.clipboard)try{await navigator.clipboard.writeText(code),button.querySelector('i').className='fa fa-check-circle fa-fw'}catch{button.querySelector('i').className='fa fa-times-circle fa-fw'}else button.querySelector('i').className='fa fa-times-circle fa-fw'}),element.addEventListener('mouseleave',()=>{setTimeout(()=>{button.querySelector('i').className='fa fa-copy fa-fw'},300)})},registerCodeblock(element){let inited=!!element,figure;(figure=CONFIG.hljswrap?(inited?element:document).querySelectorAll('figure.highlight'):document.querySelectorAll('pre')).forEach(element=>{if(!element.querySelector('.mermaid')){var languageName=[...element.classList].find(cls=>'highlight'!==cls);if(!inited){let span=element.querySelectorAll('.code .line span');(span=0===span.length?element.querySelectorAll('code.highlight span'):span).forEach(s=>{s.classList.forEach(name=>{s.classList.replace(name,'hljs-'+name)})})}var container,height=parseInt(window.getComputedStyle(element).height,10),height=CONFIG.codeblock.fold.enable&&height>CONFIG.codeblock.fold.height;if(height||CONFIG.codeblock.copy_button.enable||CONFIG.codeblock.language){let target;if(CONFIG.hljswrap&&'mac'===CONFIG.codeblock.copy_button.style)target=element;else{let box=element.querySelector('.code-container');box||(container=element.querySelector('.table-container')||element,(box=document.createElement('div')).className='code-container',container.wrap(box),box.classList.add('notranslate')),target=box}height&&!target.classList.contains('unfold')&&(target.classList.add('highlight-fold'),target.insertAdjacentHTML('beforeend','<div class="fold-cover"></div><div class="expand-btn"><i class="fa fa-angle-down fa-fw"></i></div>'),target.querySelector('.expand-btn').addEventListener('click',()=>{target.classList.remove('highlight-fold'),target.classList.add('unfold')})),!inited&&CONFIG.codeblock.copy_button.enable&&this.registerCopyButton(target,element),!inited&&CONFIG.codeblock.language&&languageName&&((container=document.createElement('div')).className='code-lang',container.innerText=languageName.toUpperCase(),target.insertAdjacentElement('afterbegin',container))}}})},wrapTableWithBox(){document.querySelectorAll('table').forEach(element=>{var box=document.createElement('div');box.className='table-container',element.wrap(box)})},registerVideoIframe(){document.querySelectorAll('iframe').forEach(element=>{var box,width,height;['www.youtube.com','player.vimeo.com','player.youku.com','player.bilibili.com','www.tudou.com'].some(host=>element.src.includes(host))&&!element.parentNode.matches('.video-container')&&((box=document.createElement('div')).className='video-container',element.wrap(box),width=Number(element.width),height=Number(element.height),width)&&height&&(box.style.paddingTop=height/width*100+'%')})},updateActiveNav(){if(Array.isArray(this.sections)){let index=this.sections.findIndex(element=>10<element?.getBoundingClientRect().top);-1===index?index=this.sections.length-1:0<index&&index--,this.activateNavByIndex(index)}},registerScrollPercent(){let backToTop=document.querySelector('.back-to-top'),readingProgressBar=document.querySelector('.reading-progress-bar');window.addEventListener('scroll',()=>{var contentHeight;(backToTop||readingProgressBar)&&(contentHeight=0<(contentHeight=document.body.scrollHeight-window.innerHeight)?Math.min(100*window.scrollY/contentHeight,100):0,backToTop&&(backToTop.classList.toggle('back-to-top-on',5<=Math.round(contentHeight)),backToTop.querySelector('span').innerText=Math.round(contentHeight)+'%'),readingProgressBar)&&readingProgressBar.style.setProperty('--progress',contentHeight.toFixed(2)+'%'),this.updateActiveNav()},{passive:!0}),backToTop?.addEventListener('click',()=>{window.anime({targets:document.scrollingElement,duration:500,easing:'linear',scrollTop:0})})},registerTabsTag(){document.querySelectorAll('.tabs ul.nav-tabs .tab').forEach(element=>{element.addEventListener('click',event=>{if(event.preventDefault(),!element.classList.contains('active')){event=element.parentNode;let tabContent=event.nextElementSibling;tabContent.style.overflow='hidden',tabContent.style.transition='height 1s';var activeTab=tabContent.querySelector('.active')||tabContent.firstElementChild,prevHeight=parseInt(window.getComputedStyle(activeTab).height,10)||0;let paddingTop=parseInt(window.getComputedStyle(activeTab).paddingTop,10),marginBottom=parseInt(window.getComputedStyle(activeTab.firstElementChild).marginBottom,10),tActive=(tabContent.style.height=prevHeight+paddingTop+marginBottom+'px',[...event.children].forEach(target=>{target.classList.toggle('active',target===element)}),document.getElementById(element.querySelector('a').getAttribute('href').replace('#',''))),hasScrollBar=([...tActive.parentNode.children].forEach(target=>{target.classList.toggle('active',target===tActive)}),tActive.dispatchEvent(new Event('tabs:click',{bubbles:!0})),document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight));activeTab=parseInt(window.getComputedStyle(tabContent.querySelector('.active')).height,10);tabContent.style.height=activeTab+paddingTop+marginBottom+'px',setTimeout(()=>{var currHeightAfterScrollBarChange;document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)!=hasScrollBar&&(tabContent.style.transition='height 0.3s linear',currHeightAfterScrollBarChange=parseInt(window.getComputedStyle(tabContent.querySelector('.active')).height,10),tabContent.style.height=currHeightAfterScrollBarChange+paddingTop+marginBottom+'px'),setTimeout(()=>{tabContent.style.transition='',tabContent.style.height=''},250)},1e3),CONFIG.stickytabs&&(prevHeight=event.parentNode.getBoundingClientRect().top+window.scrollY+10,window.anime({targets:document.scrollingElement,duration:500,easing:'linear',scrollTop:prevHeight}))}})}),window.dispatchEvent(new Event('tabs:register'))},registerCanIUseTag(){window.addEventListener('message',({data})=>{var featureID;'string'==typeof data&&data.includes('ciu_embed')&&(featureID=data.split(':')[1],data=data.split(':')[2],document.querySelector(`iframe[data-feature=${featureID}]`).style.height=parseInt(data,10)+5+'px')},!1)},registerActiveMenuItem(){document.querySelectorAll('.menu-item a[href]').forEach(target=>{var isSamePath=target.pathname===location.pathname||target.pathname===location.pathname.replace('index.html',''),isSubPath=!CONFIG.root.startsWith(target.pathname)&&location.pathname.startsWith(target.pathname);target.classList.toggle('menu-item-active',target.hostname===location.hostname&&(isSamePath||isSubPath))})},registerLangSelect(){document.querySelectorAll('.lang-select').forEach(sel=>{sel.value=CONFIG.page.lang,sel.addEventListener('change',()=>{let target=sel.options[sel.selectedIndex];document.querySelectorAll('.lang-select-label span').forEach(span=>{span.innerText=target.text}),window.location.href=target.dataset.href})})},registerSidebarTOC(){this.sections=[...document.querySelectorAll('.post-toc:not(.placeholder-toc) li a.nav-link')].map(element=>{let target=document.getElementById(decodeURI(element.getAttribute('href')).replace('#',''));return element.addEventListener('click',event=>{event.preventDefault();event=target.getBoundingClientRect().top+window.scrollY;window.anime({targets:document.scrollingElement,duration:500,easing:'linear',scrollTop:event,complete:()=>{history.pushState(null,document.title,element.href)}})}),target}),this.updateActiveNav()},registerPostReward(){var button=document.querySelector('.reward-container button');button&&button.addEventListener('click',()=>{document.querySelector('.post-reward').classList.toggle('active')})},activateNavByIndex(index){var nav=document.querySelector('.post-toc:not(.placeholder-toc) .nav');if(nav){var navItemList=nav.querySelectorAll('.nav-item'),index=navItemList[index];if(index&&!index.classList.contains('active-current')){var singleHeight=navItemList[navItemList.length-1].offsetHeight;nav.querySelectorAll('.active').forEach(navItem=>{navItem.classList.remove('active','active-current')}),index.classList.add('active','active-current');let activateEle=index.querySelector('.nav-child')||index.parentElement,navChildHeight=0;for(;nav.contains(activateEle);)activateEle.classList.contains('nav-item')?activateEle.classList.add('active'):(navChildHeight+=singleHeight*activateEle.childElementCount+5,activateEle.style.setProperty('--height',navChildHeight+'px')),activateEle=activateEle.parentElement;navItemList=document.querySelector('Pisces'===CONFIG.scheme||'Gemini'===CONFIG.scheme?'.sidebar-panel-container':'.sidebar');document.querySelector('.sidebar-toc-active')&&window.anime({targets:navItemList,duration:200,easing:'linear',scrollTop:navItemList.scrollTop-navItemList.offsetHeight/2+index.getBoundingClientRect().top-navItemList.getBoundingClientRect().top})}}},updateSidebarPosition(){if(!(window.innerWidth<1200||'Pisces'===CONFIG.scheme||'Gemini'===CONFIG.scheme)){var hasTOC=document.querySelector('.post-toc:not(.placeholder-toc)');let display=CONFIG.page.sidebar;(display='boolean'!=typeof display?'always'===CONFIG.sidebar.display||'post'===CONFIG.sidebar.display&&hasTOC:display)&&window.dispatchEvent(new Event('sidebar:show'))}},activateSidebarPanel(index){var sidebar=document.querySelector('.sidebar-inner'),activeClassNames=['sidebar-toc-active','sidebar-overview-active'];if(!sidebar.classList.contains(activeClassNames[index])){var panelContainer=sidebar.querySelector('.sidebar-panel-container'),tocPanel=panelContainer.firstElementChild,overviewPanel=panelContainer.lastElementChild;let postTOCHeight=tocPanel.scrollHeight;tocPanel=[postTOCHeight=0===index&&(tocPanel=tocPanel.querySelector('.nav'))?parseInt(tocPanel.style.getPropertyValue('--height'),10):postTOCHeight,overviewPanel.scrollHeight];panelContainer.style.setProperty('--inactive-panel-height',tocPanel[1-index]+'px'),panelContainer.style.setProperty('--active-panel-height',tocPanel[index]+'px'),sidebar.classList.replace(activeClassNames[1-index],activeClassNames[index])}},updateFooterPosition(){function updateFooterPosition(){var footer=document.querySelector('.footer'),containerHeight=document.querySelector('.main').offsetHeight+footer.offsetHeight;footer.classList.toggle('footer-fixed',containerHeight<=window.innerHeight)}'Pisces'!==CONFIG.scheme&&'Gemini'!==CONFIG.scheme&&(updateFooterPosition(),window.addEventListener('resize',updateFooterPosition),window.addEventListener('scroll',updateFooterPosition,{passive:!0}))},setGutter(gap){document.body.style.setProperty('--dialog-scrollgutter',gap||window.innerWidth-document.body.clientWidth+'px')},getScript(src,options={},legacyCondition){if('function'==typeof options)return this.getScript(src,{condition:legacyCondition}).then(options);let{condition=!1,attributes:{id='',defer=!1,crossOrigin='',dataset={},...otherAttributes}={},parentNode=null}=options,async=options.async??!1;return new Promise((resolve,reject)=>{if(condition)resolve();else{let script=document.createElement('script');id&&(script.id=id),crossOrigin&&(script.crossOrigin=crossOrigin),script.async=async,script.defer=defer,Object.assign(script.dataset,dataset),Object.entries(otherAttributes).forEach(([name,value])=>{script.setAttribute(name,String(value))}),script.onload=resolve,script.onerror=reject,'object'==typeof src?({url:resolve,integrity:reject}=src,script.src=resolve,reject&&(script.integrity=reject,script.crossOrigin='anonymous')):script.src=src,(parentNode||document.head).appendChild(script)}})},loadComments(selector,legacyCallback){return legacyCallback?this.loadComments(selector).then(legacyCallback):new Promise(resolve=>{var element=document.querySelector(selector);CONFIG.comments.lazyload&&element?new IntersectionObserver((entries,observer)=>{entries[0].isIntersecting&&(resolve(),observer.disconnect())}).observe(element):resolve()})},debounce(func,wait){let timeout;return function(...args){let context=this;clearTimeout(timeout),timeout=setTimeout(()=>func.apply(context,args),wait)}}};